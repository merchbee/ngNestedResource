"use strict";angular.module("ngNestedResource",["ngResource"]),angular.module("ngNestedResource").factory("BaseCollection",function(){var t=function(t,e,r){this.model=t,this.queryParams={},this.page=r?r:1,this.perPage=e?e:20,this.totalItems=0,this.totalPages=0,this.pages=[],this.endReached=!1};return t.prototype=[],t.prototype.populate=function(t){var e=this;return e.clear(),t.forEach(function(t){e.push(new e.model(t))}),e},t.prototype.loadMore=function(t,e,r){if(this.allLoaded())return this;var n=this;return this.queryParams.take=t?t:this.perPage,this.queryParams.skip=this.length,this.model.list(this.queryParams,e,r).then(function(t){return t.length<n.queryParams.take&&(n.endReached=!0),n.setPagination(t.headers),angular.forEach(t,function(t){n.push(t)}),n})},t.prototype.query=function(t,e,r){var n=this;return n.queryParams=t?t:{},n.queryParams.skip=0,n.queryParams.take||(n.queryParams.take=n.perPage),this.model.list(n.queryParams,e,r).then(function(t){return n.clear(),n.setPagination(t.headers),angular.forEach(t,function(t){n.push(t)}),n})},t.prototype.filter=function(t,e,r){var n=this;return n.queryParams.skip=0,n.queryParams.take||(n.queryParams.take=n.perPage),angular.extend(n.queryParams,t),this.model.list(n.queryParams,e,r).then(function(t){return n.clear(),n.setPagination(t.headers),angular.forEach(t,function(t){n.push(t)}),n})},t.prototype.clear=function(){for(;this.length>0;)this.pop();this.endReached=!1},t.prototype.allLoaded=function(){return angular.isUndefined(this.queryParams.take)||this.queryParams.take>this.length||this.endReached},t.prototype.count=function(t,e){var r=this;return this.model.count(this.queryParams,function(e,n){return r.setPagination(void 0,e),t(e,n),e},e)},t.prototype.setPagination=function(t,e){var r=this;if(angular.isUndefined(t)&&angular.isUndefined(e))return 0;r.totalItems=e||t("x-total-count"),r.totalPages=r.totalItems>=r.perPage?parseInt(r.totalItems/r.perPage):1,r.pages=[];for(var n=1;n<=r.totalPages;n++)r.pages.push({number:n,text:n})},t.prototype.selectPage=function(t,e,r,n){if(!(t>this.totalPages||t<1)){e&&(this.queryParams=e);var a=this;return this.queryParams.take=this.perPage,this.queryParams.skip=(t-1)*this.perPage,this.page=t,this.model.list(this.queryParams,r,n).then(function(t){return a.clear(),angular.forEach(t,function(t){a.push(t)}),a})}},t.prototype.noPrevious=function(){return 1===this.page},t.prototype.noNext=function(){return this.page===this.totalPages},t.prototype.remove=function(t){var e=-1;angular.forEach(this,function(r,n){e==-1&&r.id==t.id&&(e=n)}),e>-1&&this.splice(e,1),t.destroy()},function(e){var r=function(r,n){return new t(e,r,n)};return r.prototype=t.prototype,r.model=e,r}}),angular.module("ngNestedResource").factory("BaseModel",["$resource","$injector","$http",function(t,e,r){return function(n,a,o,u){u=u||{};var i=t(n,a,angular.extend({_list:{method:"GET",isArray:!0},_store:{method:"POST"},_update:{method:"PUT"},_destroy:{method:"DELETE"}},u)),s=function(t){return angular.forEach(o,function(r,n){if(!angular.isUndefined(t[n])){var a=e.get(r);angular.isArray(t[n])?"undefined"!=typeof a.model?t[n]=(new a).populate(t[n]):angular.forEach(t[n],function(e,r){t[n][r]=new a(e)}):t[n]=new a(t[n])}}),t};i.prototype.store=function(t,e){return this.$_store({},t,e).then(function(t){return s(t)})},i.prototype.update=function(t,e){return this.$_update({},t,e).then(function(t){return s(t)})},i.prototype.save=function(t,e){return this.id?this.update(t,e):this.store(t,e)},i.prototype["delete"]=function(t,e){return this.$_destroy({},t,e).then(function(t){return s(t)})},i.prototype.destroy=function(t,e){return this.$_destroy({},t,e)},i.prototype.clone=function(){var t=new i(angular.copy(this));return s(t)},i.prototype.isStored=function(){return!angular.isUndefined(this.id)};var h=function(t){return this.instance=new i(t),s(this.instance)};return h.list=function(t,e,r){return i._list(t,null,function(t,r){t.headers=r,e&&e(t,r)},r).$promise.then(function(t){return angular.forEach(t,function(e,r){t[r]=s(e)}),t})},h.get=function(t,e,r){return i.get(t,null,e,r).$promise.then(function(t){return s(t)})},h.count=function(t,e,a){return r({url:n.replace(":id","")+"count",method:"GET",params:t}).success(e).error(a)},h.prototype=i.prototype,h.parseSubModels=s,h.resource=i,h}}]);